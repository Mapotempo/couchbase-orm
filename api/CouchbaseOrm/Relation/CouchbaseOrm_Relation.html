<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: CouchbaseOrm::Relation::CouchbaseOrm_Relation
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "CouchbaseOrm::Relation::CouchbaseOrm_Relation";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../CouchbaseOrm.html" title="CouchbaseOrm (module)">CouchbaseOrm</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Relation.html" title="CouchbaseOrm::Relation (module)">Relation</a></span></span>
     &raquo; 
    <span class="title">CouchbaseOrm_Relation</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: CouchbaseOrm::Relation::CouchbaseOrm_Relation
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">CouchbaseOrm::Relation::CouchbaseOrm_Relation</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/couchbase-orm/relation.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(*args)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#all-instance_method" title="#all (instance method)">#<strong>all</strong>  &#x21d2; CouchbaseOrm_Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initializes a new query relation to fetch all records from the database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count-instance_method" title="#count (instance method)">#<strong>count</strong>  &#x21d2; Integer </a>
    

    
      (also: #size, #length)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves the count of documents that match the current query conditions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_all-instance_method" title="#delete_all (instance method)">#<strong>delete_all</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Deletes all documents that match the current query conditions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#empty%3F-instance_method" title="#empty? (instance method)">#<strong>empty?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if there are any documents that match the current query conditions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-instance_method" title="#execute (instance method)">#<strong>execute</strong>(n1ql_query)  &#x21d2; N1qlProxy </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Executes a N1QL query on the Couchbase cluster and returns the results.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_by-instance_method" title="#find_by (instance method)">#<strong>find_by</strong>(**conds)  &#x21d2; Object<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Finds the first record that matches the given conditions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#first-instance_method" title="#first (instance method)">#<strong>first</strong>  &#x21d2; Object<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves the first document that matches the current query conditions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ids-instance_method" title="#ids (instance method)">#<strong>ids</strong>  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Executes the current query and returns the result as an array of document IDs.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(model:, where: where = nil, order: order = nil, limit: limit = nil, _not: _not = false)  &#x21d2; CouchbaseOrm_Relation </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of CouchbaseOrm_Relation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#last-instance_method" title="#last (instance method)">#<strong>last</strong>  &#x21d2; Object<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves the last document that matches the current query conditions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#limit-instance_method" title="#limit (instance method)">#<strong>limit</strong>(limit)  &#x21d2; CouchbaseOrm_Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets a limit on the number of results to be returned by the query.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#not-instance_method" title="#not (instance method)">#<strong>not</strong>(**conds)  &#x21d2; CouchbaseOrm_Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds negation conditions to the query.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#order-instance_method" title="#order (instance method)">#<strong>order</strong>(*lorder, **horder)  &#x21d2; CouchbaseOrm_Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Specifies the order of the results for the query.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pluck-instance_method" title="#pluck (instance method)">#<strong>pluck</strong>(*fields)  &#x21d2; Array&lt;Object&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves specific fields from the documents that match the current query conditions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#query-instance_method" title="#query (instance method)">#<strong>query</strong>  &#x21d2; N1qlProxy </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Constructs and executes a N1QL query for Couchbase based on the current state of the instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#scoping-instance_method" title="#scoping (instance method)">#<strong>scoping</strong> { ... } &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Temporarily modifies the query scope within a block of code in a thread-safe manner.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_ary-instance_method" title="#to_ary (instance method)">#<strong>to_ary</strong>  &#x21d2; Array&lt;Object&gt; </a>
    

    
      (also: #to_a)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Converts the results of the current query into an array of model instances.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_n1ql-instance_method" title="#to_n1ql (instance method)">#<strong>to_n1ql</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Constructs a N1QL query string for Couchbase to select document IDs based on defined criteria.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_all-instance_method" title="#update_all (instance method)">#<strong>update_all</strong>(**cond)  &#x21d2; N1qlProxy </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates all documents in the Couchbase bucket that match the specified conditions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#where-instance_method" title="#where (instance method)">#<strong>where</strong>(string_cond = nil, **conds)  &#x21d2; CouchbaseOrm_Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds conditions to the query.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(model:, where: where = nil, order: order = nil, limit: limit = nil, _not: _not = false)  &#x21d2; <tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of CouchbaseOrm_Relation.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 8</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='label'>model:</span><span class='comma'>,</span> <span class='label'>where:</span> <span class='id identifier rubyid_where'>where</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>order:</span> <span class='id identifier rubyid_order'>order</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='id identifier rubyid_limit'>limit</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>_not:</span> <span class='id identifier rubyid__not'>_not</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../CouchbaseOrm.html" title="CouchbaseOrm (module)">CouchbaseOrm</a></span></span><span class='period'>.</span><span class='id identifier rubyid_logger'><span class='object_link'><a href="../../CouchbaseOrm.html#logger-class_method" title="CouchbaseOrm.logger (method)">logger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CouchbaseOrm_Relation init: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_model'>model</span><span class='embexpr_end'>}</span><span class='tstring_content'> where:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_where'>where</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> not:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid__not'>_not</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> order:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> limit: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_limit'>limit</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@model</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span>
  <span class='ivar'>@limit</span> <span class='op'>=</span> <span class='id identifier rubyid_limit'>limit</span>
  <span class='ivar'>@where</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@order</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@order</span> <span class='op'>=</span> <span class='id identifier rubyid_merge_order'>merge_order</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_order'>order</span>
  <span class='ivar'>@where</span> <span class='op'>=</span> <span class='id identifier rubyid_merge_where'>merge_where</span><span class='lparen'>(</span><span class='id identifier rubyid_where'>where</span><span class='comma'>,</span> <span class='id identifier rubyid__not'>_not</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_where'>where</span>
  <span class='const'><span class='object_link'><a href="../../CouchbaseOrm.html" title="CouchbaseOrm (module)">CouchbaseOrm</a></span></span><span class='period'>.</span><span class='id identifier rubyid_logger'><span class='object_link'><a href="../../CouchbaseOrm.html#logger-class_method" title="CouchbaseOrm.logger (method)">logger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>- </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>
<div id="method_missing_details" class="method_details_list">
  <h2>Dynamic Method Handling</h2>
  <p class="notice this">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
  </p>
  
    <div class="method_details first">
  <h3 class="signature first" id="method_missing-instance_method">
  
    #<strong>method_missing</strong>(method, *args, &amp;block)  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


539
540
541
542
543
544
545
546
547</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 539</span>

<span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_scoping'>scoping</span> <span class='lbrace'>{</span>
      <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_public_send'>public_send</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="[]-instance_method">
  
    #<strong>[]</strong>(*args)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


261
262
263</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 261</span>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_to_ary'>to_ary</span><span class='lbracket'>[</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="all-instance_method">
  
    #<strong>all</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initializes a new query relation to fetch all records from the database.</p>

<p>This method creates a new `CouchbaseOrm_Relation` instance, setting the stage for a query that can fetch all records. It serves as a base that can be extended with further conditions, limits, orders, etc.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Fetch all users and apply additional query conditions</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fetch_all_active_users'>fetch_all_active_users</span>
    <span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_active_users'>active_users</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_fetch_all_active_users'>fetch_all_active_users</span>
<span class='comment'># This initializes a query to fetch all users, then narrows it down to active users,
</span><span class='comment'># and orders them by their creation date in descending order.</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A new relation instance ready to fetch all records.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


420
421
422</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 420</span>

<span class='kw'>def</span> <span class='id identifier rubyid_all'>all</span>
  <span class='const'><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_initializer_arguments'>initializer_arguments</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="count-instance_method">
  
    #<strong>count</strong>  &#x21d2; <tt>Integer</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='size-instance_method'>size</span>, <span id='length-instance_method'>length</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retrieves the count of documents that match the current query conditions.</p>

<p>This method constructs and executes a N1QL query based on the current state of the instance and returns the count of documents that match the query conditions.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The count of documents that match the query conditions.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 184</span>

<span class='kw'>def</span> <span class='id identifier rubyid_count'>count</span>
  <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_all-instance_method">
  
    #<strong>delete_all</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Deletes all documents that match the current query conditions.</p>

<p>This method constructs and executes a N1QL query to get the IDs of the matching documents and then deletes them using the model&#39;s `remove_multi` method.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Delete all inactive users</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_delete_inactive_users'>delete_inactive_users</span>
    <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete_all'>delete_all</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_delete_inactive_users'>delete_inactive_users</span>
<span class='comment'># This will construct and execute the N1QL query to retrieve the IDs of all inactive users
</span><span class='comment'># and delete the corresponding documents.</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


283
284
285
286
287</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 283</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_all'>delete_all</span>
  <span class='const'><span class='object_link'><a href="../../CouchbaseOrm.html" title="CouchbaseOrm (module)">CouchbaseOrm</a></span></span><span class='period'>.</span><span class='id identifier rubyid_logger'><span class='object_link'><a href="../../CouchbaseOrm.html#logger-class_method" title="CouchbaseOrm.logger (method)">logger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Delete all: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_ids'>ids</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_remove_multi'>remove_multi</span><span class='lparen'>(</span><span class='id identifier rubyid_ids'>ids</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_ids'>ids</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="empty?-instance_method">
  
    #<strong>empty?</strong>  &#x21d2; <tt><span class='object_link'><a href="../../Boolean.html" title="Boolean (class)">Boolean</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if there are any documents that match the current query conditions.</p>

<p>This method constructs and executes a N1QL query with a limit of 1 document and returns true if no documents match the query conditions.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Boolean.html" title="Boolean (class)">Boolean</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>True if no documents match the query conditions, false otherwise.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 194</span>

<span class='kw'>def</span> <span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute-instance_method">
  
    #<strong>execute</strong>(n1ql_query)  &#x21d2; <tt><span class='object_link'><a href="../N1qlProxy.html" title="CouchbaseOrm::N1qlProxy (class)">N1qlProxy</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Executes a N1QL query on the Couchbase cluster and returns the results.</p>

<p>This method runs the provided N1QL query using the Couchbase cluster associated with the model. It ensures the query is executed with a consistent view of the data. The results are logged and returned wrapped in a `N1qlProxy` object.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Execute a N1QL query to find active users</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="../../CouchbaseOrm.html" title="CouchbaseOrm (module)">CouchbaseOrm</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Base.html" title="CouchbaseOrm::Base (class)">Base</a></span></span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_users'>active_users</span>
    <span class='id identifier rubyid_n1ql_query'>n1ql_query</span> <span class='op'>=</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
                    <span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
                    <span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>
                    <span class='period'>.</span><span class='id identifier rubyid_to_n1ql'>to_n1ql</span>
    <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_n1ql_query'>n1ql_query</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_active_users'>active_users</span>
<span class='comment'># This will execute the N1QL query and return the results wrapped in a `N1qlProxy` object.
</span><span class='comment'># You can iterate over the results, access specific fields, etc.</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>n1ql_query</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The N1QL query to be executed.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../N1qlProxy.html" title="CouchbaseOrm::N1qlProxy (class)">N1qlProxy</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The results of the query wrapped in a `N1qlProxy` object.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 71</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_n1ql_query'>n1ql_query</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='id identifier rubyid_n1ql_query'>n1ql_query</span><span class='comma'>,</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Options</span><span class='op'>::</span><span class='const'>Query</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>scan_consistency:</span> <span class='symbol'>:request_plus</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../CouchbaseOrm.html" title="CouchbaseOrm (module)">CouchbaseOrm</a></span></span><span class='period'>.</span><span class='id identifier rubyid_logger'><span class='object_link'><a href="../../CouchbaseOrm.html#logger-class_method" title="CouchbaseOrm.logger (method)">logger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Relation query: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_n1ql_query'>n1ql_query</span><span class='embexpr_end'>}</span><span class='tstring_content'> return </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> rows</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='const'><span class='object_link'><a href="../N1qlProxy.html" title="CouchbaseOrm::N1qlProxy (class)">N1qlProxy</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../N1qlProxy.html#initialize-instance_method" title="CouchbaseOrm::N1qlProxy#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_by-instance_method">
  
    #<strong>find_by</strong>(**conds)  &#x21d2; <tt>Object</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Finds the first record that matches the given conditions.</p>

<p>This method constructs a query with the specified conditions and returns the first matching record.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Find a user by email</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_by_email'>find_by_email</span><span class='lparen'>(</span><span class='id identifier rubyid_email'>email</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>email:</span> <span class='id identifier rubyid_email'>email</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_by_email'>find_by_email</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>example@example.com</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='comment'># This will create a query with the condition for email and return the first matching user.</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>conds</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Conditions as key-value pairs.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The first record that matches the conditions, or nil if no record matches.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


329
330
331</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 329</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_conds'>conds</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_initializer_arguments'>initializer_arguments</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>where:</span> <span class='id identifier rubyid_merge_where'>merge_where</span><span class='lparen'>(</span><span class='id identifier rubyid_conds'>conds</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'><span class='object_link'><a href="#first-instance_method" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation#first (method)">first</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="first-instance_method">
  
    #<strong>first</strong>  &#x21d2; <tt>Object</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retrieves the first document that matches the current query conditions.</p>

<p>This method modifies the current query to limit the result to 1 document, executes the query, and returns the first document that matches the query conditions.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The first document that matches the query conditions, or nil if no documents match.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161
162
163
164</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 159</span>

<span class='kw'>def</span> <span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_n1ql'>to_n1ql</span><span class='comma'>,</span>
                                <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Options</span><span class='op'>::</span><span class='const'>Query</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>scan_consistency:</span> <span class='symbol'>:request_plus</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_first_id'>first_id</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_first_id'>first_id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_first_id'>first_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ids-instance_method">
  
    #<strong>ids</strong>  &#x21d2; <tt>Array&lt;String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Executes the current query and returns the result as an array of document IDs.</p>

<p>This method constructs and executes a N1QL query based on the current state of the instance, and converts the result to an array of document IDs.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Retrieve IDs of active users created before a certain date</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="../../CouchbaseOrm.html" title="CouchbaseOrm (module)">CouchbaseOrm</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Base.html" title="CouchbaseOrm::Base (class)">Base</a></span></span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_users'>active_users</span>
    <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
      <span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
      <span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>
      <span class='period'>.</span><span class='id identifier rubyid_ids'>ids</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_user_ids'>user_ids</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_active_user_ids'>active_user_ids</span>
<span class='comment'># This will construct and execute the N1QL query to retrieve the IDs of active users
</span><span class='comment'># created before a certain date, and return the result as an array of document IDs.
</span><span class='comment'># You can iterate over the IDs, fetch specific documents by ID, etc.</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>An array of document IDs.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


149
150
151</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 149</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ids'>ids</span>
  <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="last-instance_method">
  
    #<strong>last</strong>  &#x21d2; <tt>Object</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retrieves the last document that matches the current query conditions.</p>

<p>This method executes the query, and returns the last document that matches the query conditions.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The last document that matches the query conditions, or nil if no documents match.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 172</span>

<span class='kw'>def</span> <span class='id identifier rubyid_last'>last</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='id identifier rubyid_to_n1ql'>to_n1ql</span><span class='comma'>,</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Options</span><span class='op'>::</span><span class='const'>Query</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>scan_consistency:</span> <span class='symbol'>:request_plus</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_last_id'>last_id</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
  <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_last_id'>last_id</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_last_id'>last_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="limit-instance_method">
  
    #<strong>limit</strong>(limit)  &#x21d2; <tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets a limit on the number of results to be returned by the query.</p>

<p>This method updates the query configuration to include a specified limit, controlling the amount of data retrieved from the database. It returns a new `CouchbaseOrm_Relation` instance with the updated configuration.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Retrieve only 5 users</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_top_five'>find_top_five</span>
    <span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>5</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_top_five_users'>top_five_users</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_top_five'>find_top_five</span>
<span class='comment'># This will return only the first five user records from the query.</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>limit</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The maximum number of records to return.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A new relation instance with the specified limit.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


398
399
400</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 398</span>

<span class='kw'>def</span> <span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='id identifier rubyid_limit'>limit</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_initializer_arguments'>initializer_arguments</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>limit:</span> <span class='id identifier rubyid_limit'>limit</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="not-instance_method">
  
    #<strong>not</strong>(**conds)  &#x21d2; <tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds negation conditions to the query.</p>

<p>This method allows you to specify conditions that should not be matched by the query. It returns a new `CouchbaseOrm_Relation` instance with the updated conditions.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Exclude users with a specific role</p>
</div></h5>
      
      <pre class="example code"><code>class User &lt; Couchbase::Base

  def self.exclude_role(role)
    not(role: role)
  end
end

non_admins = User.exclude_role(&#39;admin&#39;)
# This will create a query excluding users with the &#39;admin&#39; role.</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>conds</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Conditions as key-value pairs that should be negated.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A new relation instance with the negated conditions.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


351
352
353</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 351</span>

<span class='kw'>def</span> <span class='kw'>not</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_conds'>conds</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_initializer_arguments'>initializer_arguments</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>where:</span> <span class='id identifier rubyid_merge_where'>merge_where</span><span class='lparen'>(</span><span class='id identifier rubyid_conds'>conds</span><span class='comma'>,</span> <span class='label'>_not:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="order-instance_method">
  
    #<strong>order</strong>(*lorder, **horder)  &#x21d2; <tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Specifies the order of the results for the query.</p>

<p>This method allows for the specification of how query results should be ordered, using both positional and named arguments. It returns a new `CouchbaseOrm_Relation` instance with the updated order conditions.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Order users by creation date in descending order</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_order_by_creation_desc'>order_by_creation_desc</span>
    <span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_ordered_users'>ordered_users</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_order_by_creation_desc'>order_by_creation_desc</span>
<span class='comment'># This will create a query with an order condition for users ordered by &#39;created_at&#39; descending.</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>lorder</span>
      
      
        <span class='type'>(<tt>Array&lt;String, Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Positional ordering parameters.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>horder</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Named ordering parameters with directions.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A new relation instance with the updated ordering.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


375
376
377</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 375</span>

<span class='kw'>def</span> <span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_lorder'>lorder</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_horder'>horder</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_initializer_arguments'>initializer_arguments</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>order:</span> <span class='id identifier rubyid_merge_order'>merge_order</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_lorder'>lorder</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_horder'>horder</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pluck-instance_method">
  
    #<strong>pluck</strong>(*fields)  &#x21d2; <tt>Array&lt;Object&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retrieves specific fields from the documents that match the current query conditions.</p>

<p>This method constructs and executes a N1QL query to retrieve the specified fields from the documents that match the current query conditions.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Retrieve the names of all active users</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_user_names'>active_user_names</span>
    <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_active_user_names'>active_user_names</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_active_user_names'>active_user_names</span>
<span class='comment'># This will construct and execute the N1QL query to retrieve the names of all active users
</span><span class='comment'># and return an array of names.</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>fields</span>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The fields to retrieve from the documents.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Object&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>An array of field values for each document.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


217
218
219
220
221
222
223
224
225
226
227</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 217</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_fields'>fields</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_model'>model</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span>
      <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
        <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="query-instance_method">
  
    #<strong>query</strong>  &#x21d2; <tt><span class='object_link'><a href="../N1qlProxy.html" title="CouchbaseOrm::N1qlProxy (class)">N1qlProxy</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Constructs and executes a N1QL query for Couchbase based on the current state of the instance.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Execute a query to find active users</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="../../CouchbaseOrm.html" title="CouchbaseOrm (module)">CouchbaseOrm</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Base.html" title="CouchbaseOrm::Base (class)">Base</a></span></span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_users'>active_users</span>
    <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
      <span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>created_at:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
      <span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>
      <span class='period'>.</span><span class='id identifier rubyid_query'>query</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_active_users'>active_users</span>
<span class='comment'># This will execute the N1QL query and return the results wrapped in a `N1qlProxy` object.
</span><span class='comment'># You can iterate over the results, access specific fields, etc.</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../N1qlProxy.html" title="CouchbaseOrm::N1qlProxy (class)">N1qlProxy</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The results of the query wrapped in a `N1qlProxy` object.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 95</span>

<span class='kw'>def</span> <span class='id identifier rubyid_query'>query</span>
  <span class='const'><span class='object_link'><a href="../../CouchbaseOrm.html" title="CouchbaseOrm (module)">CouchbaseOrm</a></span></span><span class='period'>.</span><span class='id identifier rubyid_logger'><span class='object_link'><a href="../../CouchbaseOrm.html#logger-class_method" title="CouchbaseOrm.logger (method)">logger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Query: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_n1ql_query'>n1ql_query</span> <span class='op'>=</span> <span class='id identifier rubyid_to_n1ql'>to_n1ql</span>
  <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_n1ql_query'>n1ql_query</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="scoping-instance_method">
  
    #<strong>scoping</strong> { ... } &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Temporarily modifies the query scope within a block of code in a thread-safe manner.</p>

<p>This method is used to apply temporary query conditions which are only meant to last during the execution of the given block. It ensures that the scope is added before the block is executed and properly removed afterward, even if an exception occurs.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Apply a temporary scope to increase salary for specific calculations</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>Employee</span>  <span class='op'>&lt;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_temporary_increase'>temporary_increase</span><span class='lparen'>(</span><span class='id identifier rubyid_factor'>factor</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_scoping'>scoping</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>salary:</span> <span class='id identifier rubyid_salary'>salary</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>*</span> <span class='id identifier rubyid_factor'>factor</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
      <span class='comment'># Other operations that depend on this temporary scope
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'>Employee</span><span class='period'>.</span><span class='id identifier rubyid_temporary_increase'>temporary_increase</span><span class='lparen'>(</span><span class='float'>1.10</span><span class='rparen'>)</span>
<span class='comment'># This will temporarily increase the salary by 10% within the block, for whatever operations are needed.</span></code></pre>
    
  </div>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>The block during which the temporary scope should be applied.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The result of the block execution.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


446
447
448
449
450
451
452
453</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 446</span>

<span class='kw'>def</span> <span class='id identifier rubyid_scoping'>scoping</span>
  <span class='id identifier rubyid_scopes'>scopes</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_scopes'>scopes</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>yield</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_scopes'>scopes</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_ary-instance_method">
  
    #<strong>to_ary</strong>  &#x21d2; <tt>Array&lt;Object&gt;</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='to_a-instance_method'>to_a</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Converts the results of the current query into an array of model instances.</p>

<p>This method executes the current query to get the IDs of the matching documents, fetches the documents using the model&#39;s `find` method, and returns them as an array.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Retrieve all active users as an array</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_users'>active_users</span>
    <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_ary'>to_ary</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_active_users'>active_users</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_active_users'>active_users</span>
<span class='comment'># This will construct and execute the N1QL query to retrieve the IDs of all active users,
</span><span class='comment'># fetch the corresponding documents, and return them as an array of user instances.</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Object&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>An array of model instances that match the query conditions.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


250
251
252
253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 250</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_ary'>to_ary</span>
  <span class='id identifier rubyid_ids'>ids</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_results'>results</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_ids'>ids</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_ids'>ids</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ids'>ids</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_n1ql-instance_method">
  
    #<strong>to_n1ql</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Constructs a N1QL query string for Couchbase to select document IDs based on defined criteria.</p>

<p>N1QL (Non-first Normal Form Query Language) is a powerful query language for Couchbase that allows you to perform complex queries on your data. For more details, see the [Couchbase N1QL Documentation](<a href="https://docs.couchbase.com/server/current/n1ql/n1ql-intro/index.html">docs.couchbase.com/server/current/n1ql/n1ql-intro/index.html</a>).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Construct a N1QL query to find document IDs with specific criteria</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Base</span>
  <span class='id identifier rubyid_attribute'>attribute</span> <span class='symbol'>:active</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='symbol'>:bool</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_user_query'>user_query</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span>
                 <span class='period'>.</span><span class='id identifier rubyid_to_n1ql'>to_n1ql</span>
<span class='comment'># user_query =&gt; &quot;select raw meta().id from `bucket_name` where type = &#39;user&#39; and active = true&quot;</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The constructed N1QL query string.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41
42
43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_n1ql'>to_n1ql</span>
  <span class='id identifier rubyid_bucket_name'>bucket_name</span> <span class='op'>=</span> <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_bucket'>bucket</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_where'>where</span> <span class='op'>=</span> <span class='id identifier rubyid_build_where'>build_where</span>
  <span class='id identifier rubyid_order'>order</span> <span class='op'>=</span> <span class='id identifier rubyid_build_order'>build_order</span>
  <span class='id identifier rubyid_limit'>limit</span> <span class='op'>=</span> <span class='id identifier rubyid_build_limit'>build_limit</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>select raw meta().id from `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bucket_name'>bucket_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>` where </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_where'>where</span><span class='embexpr_end'>}</span><span class='tstring_content'> order by </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_order'>order</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_limit'>limit</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_s-instance_method">
  
    #<strong>to_s</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_s'>to_s</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CouchbaseOrm_Relation: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@model</span><span class='embexpr_end'>}</span><span class='tstring_content'> where:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@where</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> order:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@order</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> limit: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@limit</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_all-instance_method">
  
    #<strong>update_all</strong>(**cond)  &#x21d2; <tt><span class='object_link'><a href="../N1qlProxy.html" title="CouchbaseOrm::N1qlProxy (class)">N1qlProxy</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Updates all documents in the Couchbase bucket that match the specified conditions.</p>

<p>This method constructs and executes a N1QL query to update documents in the Couchbase bucket based on the specified conditions. It logs the query execution and returns the results.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Update the &#39;active&#39; status of users created before a certain date</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="../../CouchbaseOrm.html" title="CouchbaseOrm (module)">CouchbaseOrm</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Base.html" title="CouchbaseOrm::Base (class)">Base</a></span></span>
 <span class='comment'># attributes
</span><span class='kw'>end</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>created_at &lt; &#39;2023-01-01&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update_all'>update_all</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>false</span><span class='rparen'>)</span>
<span class='comment'># This will construct and execute the N1QL query to update all users created before 2023-01-01
</span><span class='comment'># to have &#39;active&#39; set to false.
</span><span class='comment'># You can iterate over the results, check the status, etc.</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>cond</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The conditions to update the documents with.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../N1qlProxy.html" title="CouchbaseOrm::N1qlProxy (class)">N1qlProxy</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The results of the update operation wrapped in a `N1qlProxy` object.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


118
119
120
121
122
123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 118</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_all'>update_all</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_cond'>cond</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bucket_name'>bucket_name</span> <span class='op'>=</span> <span class='ivar'>@model</span><span class='period'>.</span><span class='id identifier rubyid_bucket'>bucket</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_where'>where</span> <span class='op'>=</span> <span class='id identifier rubyid_build_where'>build_where</span>
  <span class='id identifier rubyid_limit'>limit</span> <span class='op'>=</span> <span class='id identifier rubyid_build_limit'>build_limit</span>
  <span class='id identifier rubyid_update'>update</span> <span class='op'>=</span> <span class='id identifier rubyid_build_update'>build_update</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_cond'>cond</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_n1ql_query'>n1ql_query</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bucket_name'>bucket_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>` set </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_update'>update</span><span class='embexpr_end'>}</span><span class='tstring_content'> where </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_where'>where</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_limit'>limit</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_n1ql_query'>n1ql_query</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="where-instance_method">
  
    #<strong>where</strong>(string_cond = nil, **conds)  &#x21d2; <tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds conditions to the query.</p>

<p>This method allows you to specify query conditions using a string and/or a hash. It returns a new `CouchbaseOrm_Relation` instance with the updated conditions.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'>
<p>Find all active users with a specific role</p>
</div></h5>
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_active_with_role'>active_with_role</span><span class='lparen'>(</span><span class='id identifier rubyid_role'>role</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>active:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>role:</span> <span class='id identifier rubyid_role'>role</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_active_admins'>active_admins</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_active_with_role'>active_with_role</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='comment'># This will create a query with conditions for active users with the role &#39;admin&#39;
</span><span class='comment'># and return a new `CouchbaseOrm_Relation` instance with these conditions.</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>string_cond</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Additional conditions in a string format (optional).</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>conds</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Conditions as key-value pairs (optional).</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A new relation instance with the updated conditions.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


309
310
311</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase-orm/relation.rb', line 309</span>

<span class='kw'>def</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_string_cond'>string_cond</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_conds'>conds</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation (class)">CouchbaseOrm_Relation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="CouchbaseOrm::Relation::CouchbaseOrm_Relation#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_initializer_arguments'>initializer_arguments</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>where:</span> <span class='id identifier rubyid_merge_where'>merge_where</span><span class='lparen'>(</span><span class='id identifier rubyid_conds'>conds</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_string_where'>string_where</span><span class='lparen'>(</span><span class='id identifier rubyid_string_cond'>string_cond</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue May 27 10:04:05 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-2.7.8).
</div>

    </div>
  </body>
</html>